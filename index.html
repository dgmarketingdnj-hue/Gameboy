<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Tap Earn Game üöÄ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Monetag Rewarded Ads SDK -->
    <script src="//libtl.com/sdk.js" data-zone="10362739" data-sdk="show_10362739" async></script>
    <style>
        * { box-sizing: border-box; touch-action: manipulation; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            text-align: center; 
            background: linear-gradient(135deg, #000 0%, #001133 50%, #000 100%);
            color: white; 
            margin: 0; padding: 10px; 
            overflow-x: hidden; 
            height: 100vh;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        h1 { 
            font-size: clamp(20px, 5vw, 28px); 
            margin: 10px 0; 
            text-shadow: 0 0 20px gold;
        }
        #username { 
            font-size: clamp(16px, 4vw, 20px); 
            margin: 5px; 
            color: #FFD700; 
            font-weight: 600;
        }
        #points { 
            font-size: clamp(32px, 8vw, 48px); 
            margin: 15px 0; 
            font-weight: bold; 
            text-shadow: 0 0 15px lime;
            animation: pointsGlow 2s ease-in-out infinite alternate;
        }
        @keyframes pointsGlow {
            from { text-shadow: 0 0 15px lime; }
            to { text-shadow: 0 0 25px lime, 0 0 35px lime; }
        }
        #tap-area { 
            position: relative; 
            width: clamp(220px, 50vw, 280px); 
            height: clamp(220px, 50vw, 280px); 
            margin: 20px auto; 
        }
        #tap-button { 
            position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 100%; height: 100%; 
            background: transparent; 
            border: none; 
            cursor: pointer; 
            font-size: clamp(120px, 30vw, 180px);
            z-index: 10;
            transition: transform 0.1s ease-out;
        }
        #tap-button:active { 
            transform: translate(-50%, -50%) scale(0.85); 
        }
        #tap-ring {
            position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 100%; height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, transparent 70%);
            animation: rotate 3s linear infinite;
            z-index: 1;
        }
        @keyframes rotate {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            max-width: 400px;
            margin: 20px auto;
        }
        button { 
            padding: clamp(12px, 3vw, 16px) clamp(20px, 5vw, 28px); 
            font-size: clamp(14px, 3.5vw, 18px); 
            background: linear-gradient(45deg, #007bff, #0056b3); 
            color: white; 
            border: none; 
            border-radius: 15px; 
            cursor: pointer; 
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,123,255,0.4);
            transition: all 0.2s ease;
            min-height: 50px;
        }
        button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(0,123,255,0.6);
        }
        button:active { transform: translateY(0); }
        button:disabled { background: #666; cursor: not-allowed; transform: none; }
        #sound-toggle { 
            background: linear-gradient(45deg, #28a745, #20c997) !important;
            grid-column: span 2;
        }
        .floating-text { 
            position: fixed; 
            font-size: clamp(24px, 6vw, 36px); 
            font-weight: bold; 
            color: #FFD700; 
            pointer-events: none; 
            z-index: 100;
            text-shadow: 0 0 10px gold;
            animation: floatUp 1.2s ease-out forwards;
        }
        @keyframes floatUp { 
            0% { opacity: 1; transform: translateY(0) scale(1); } 
            100% { opacity: 0; transform: translateY(-120px) scale(1.2); } 
        }
        .coin { 
            position: fixed; 
            font-size: clamp(30px, 8vw, 45px); 
            pointer-events: none; 
            z-index: 50;
            animation: coinFly 1s ease-out forwards;
        }
        @keyframes coinFly { 
            0% { opacity: 1; transform: translate(0,0) scale(1) rotate(0deg); } 
            50% { opacity: 1; transform: translate(var(--dx), var(--dy1)) scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: translate(var(--dx), var(--dy2)) scale(0.5) rotate(360deg); }
        }
        /* Modals */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); 
            z-index: 1000; 
            justify-content: center; 
            align-items: center; 
            padding: 20px;
        }
        .modal-content { 
            background: linear-gradient(135deg, #111, #222); 
            border-radius: 20px; 
            padding: 25px; 
            max-width: 90vw; 
            max-height: 90vh; 
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.8);
        }
        .close-btn { background: #dc3545 !important; }
        #leaderboard-list { 
            list-style: none; padding: 0; max-height: 400px; overflow-y: auto; 
        }
        #leaderboard-list li { 
            padding: 15px; 
            border-bottom: 1px solid #444; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            font-size: 16px;
        }
        #leaderboard-list li:nth-child(odd) { background: rgba(255,255,255,0.05); }
        .rank-1 { color: gold; font-size: 18px; font-weight: bold; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }
    </style>
</head>
<body>
    <h1>üöÄ Tap to Earn Points! üöÄ</h1>
    <div id="username">Welcome Player!</div>
    <div id="points">Points: 0</div>
    
    <div id="tap-area">
        <div id="tap-ring"></div>
        <button id="tap-button" aria-label="Tap to earn">ü™ô</button>
    </div>
    
    <div class="button-grid">
        <button id="sound-toggle" onclick="toggleSound()">üîä Sound ON</button>
        <button onclick="watchRewardedAd()">üì∫ Watch Ad +300</button>
        <button onclick="dailyReward()">üéÅ Daily Bonus</button>
        <button onclick="showReferral()">üë• Invite Friends</button>
        <button onclick="spinToWin()">üé° Spin to Win</button>
        <!-- REMOVED DUPLICATE LEADERBOARD BUTTON -->
    </div>

    <!-- Spin Modal -->
    <div id="spin-modal" class="modal">
        <div class="modal-content">
            <div style="position: relative;">
                <div id="wheel-pointer" style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 40px; z-index: 10;">üéØ</div>
                <canvas id="wheel" width="280" height="280" style="border-radius: 50%; display: block; margin: 0 auto;"></canvas>
            </div>
            <button id="spin-btn" onclick="startSpin()" style="background: linear-gradient(45deg, gold, orange) !important; color: black; font-size: 20px; padding: 15px 30px; margin: 20px 0;">üé° SPIN TO WIN! üé°</button>
            <div id="result" style="font-size: 24px; color: lime; margin: 20px 0; font-weight: bold;"></div>
            <button onclick="closeSpinModal()" class="close-btn">‚ùå Close</button>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content">
            <h2 style="margin-top: 0;">üèÜ TOP PLAYERS</h2>
            <ul id="leaderboard-list"></ul>
            <button onclick="closeLeaderboard()" class="close-btn" style="width: 100%; margin-top: 20px;">‚ùå Close</button>
        </div>
    </div>

    <script>
        // Audio (Mobile Optimized)
        const tapSound = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAo');
        tapSound.volume = 0.3;

        let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
        let points = parseInt(localStorage.getItem('points') || '0');
        let currentRotation = 0;
        const prizes = [
            { points: 1000, color: '#FFD700', text: '1000 PTS!' },
            { points: 500, color: '#FFA500', text: '500 PTS!' },
            { points: 200, color: '#FF4500', text: '200 PTS' },
            { points: 100, color: '#32CD32', text: '100 PTS' },
            { points: 50, color: '#00BFFF', text: '50 PTS' },
            { points: 0, color: '#FF69B4', text: 'TRY AGAIN' }
        ];

        const pointsDisplay = document.getElementById('points');
        const usernameDisplay = document.getElementById('username');
        const tapButton = document.getElementById('tap-button');
        const tapArea = document.getElementById('tap-area');

        // Telegram Integration - FIXED LEADERBOARD DUPLICATE
        if (window.Telegram?.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            const user = Telegram.WebApp.initDataUnsafe.user;
            if (user) {
                usernameDisplay.innerText = `Welcome, ${user.first_name}! üëã`;
            }
            // MainButton ONLY for Leaderboard - NO DUPLICATE
            Telegram.WebApp.MainButton.setText('üèÜ Leaderboard').show().onClick(showLeaderboard);
        }

        function updatePoints() {
            pointsDisplay.innerText = `Points: ${points.toLocaleString()}`;
            localStorage.setItem('points', points);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled);
            document.getElementById('sound-toggle').innerText = soundEnabled ? 'üîä Sound ON' : 'üîá Sound OFF';
        }

        function playSound() {
            if (soundEnabled) {
                tapSound.currentTime = 0;
                tapSound.play().catch(() => {});
            }
        }

        // Enhanced Mobile Tap
        function handleTap(e) {
            e.preventDefault();
            const rect = tapArea.getBoundingClientRect();
            const x = e.clientX || (e.touches && e.touches[0].clientX);
            const y = e.clientY || (e.touches && e.touches[0].clientY);
            const tapX = x - rect.left - rect.width/2;
            const tapY = y - rect.top - rect.height/2;

            points += 20;
            updatePoints();
            playSound();

            // Floating +20
            const floatText = document.createElement('div');
            floatText.className = 'floating-text';
            floatText.innerText = '+20';
            floatText.style.left = `${x}px`;
            floatText.style.top = `${y}px`;
            document.body.appendChild(floatText);
            setTimeout(() => floatText.remove(), 1200);

            // Coin explosion
            for (let i = 0; i < 5; i++) {
                createCoin(x, y, i);
            }
        }

        function createCoin(x, y, i) {
            const coin = document.createElement('div');
            coin.className = 'coin';
            coin.innerText = 'ü™ô';
            coin.style.left = `${x}px`;
            coin.style.top = `${y}px`;
            coin.style.setProperty('--dx', `${(Math.random()-0.5)*150}px`);
            coin.style.setProperty('--dy1', `${(Math.random()-0.5)*80}px`);
            coin.style.setProperty('--dy2', `${Math.random()*-150}px`);
            document.body.appendChild(coin);
            setTimeout(() => coin.remove(), 1000);
        }

        // Touch & Click Events
        tapButton.addEventListener('click', handleTap);
        tapArea.addEventListener('touchstart', handleTap, { passive: false });
        tapArea.addEventListener('touchend', e => e.preventDefault());

        // FIXED Invite Friends - ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ BOT USERNAME ‡¶¶‡¶ø‡¶®!
        function showReferral() {
            if (!Telegram?.WebApp) return alert('Open in Telegram!');
            const userId = Telegram.WebApp.initDataUnsafe.user?.id || 'unknown';
            const botUsername = 'myearninggameboy_bot'; // ‚Üê‚Üê‚Üê ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ BOT ‡¶è‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï username ‡¶¶‡¶ø‡¶®!
            const link = `https://t.me/${botUsername}?start=ref_${userId}`;
            Telegram.WebApp.openTelegramLink(link);
            alert(`Share this link with friends!\n${link}\n\nThey join = You get bonus! üî•`);
        }

        // Monetag Rewarded Ad
        function watchRewardedAd() {
            const showAd = window.show_10362739;
            if (typeof showAd !== 'function') {
                return alert('Ad loading... Try again!');
            }
            showAd().then(() => {
                points += 300;
                updatePoints();
                alert('üéâ Ad Watched! +300 Points');
            }).catch(() => alert('Ad closed early üòî'));
        }

        // Daily Reward
        function dailyReward() {
            const lastLogin = localStorage.getItem('lastLogin');
            const today = new Date().toDateString();
            if (lastLogin !== today) {
                points += 500;
                updatePoints();
                localStorage.setItem('lastLogin', today);
                alert('üíé Daily Bonus! +500 Points');
            } else {
                alert('Already claimed today! Come tomorrow üìÖ');
            }
        }

        // Spin Wheel Functions (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á)
        function spinToWin() {
            const lastSpin = localStorage.getItem('lastSpin');
            const now = Date.now();
            if (lastSpin && now - parseInt(lastSpin) < 8*60*60*1000) {
                return alert('Free spin every 8 hours! ‚è∞');
            }
            document.getElementById('spin-modal').style.display = 'flex';
            drawWheel();
            localStorage.setItem('lastSpin', now);
        }

        function closeSpinModal() {
            document.getElementById('spin-modal').style.display = 'none';
            document.getElementById('result').innerText = '';
        }

        function drawWheel() {
            const canvas = document.getElementById('wheel');
            const ctx = canvas.getContext('2d');
            const centerX = 140, centerY = 140, radius = 135;
            const angle = (Math.PI * 2) / prizes.length;

            ctx.clearRect(0, 0, 280, 280);
            for (let i = 0; i < prizes.length; i++) {
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, i * angle, (i + 1) * angle);
                ctx.fillStyle = prizes[i].color;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(i * angle + angle / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = '#000';
                ctx.font = 'bold 16px Arial';
                ctx.fillText(prizes[i].text, radius - 25, 8);
                ctx.restore();
            }
        }

        function startSpin() {
            const spinBtn = document.getElementById('spin-btn');
            spinBtn.disabled = true;
            spinBtn.innerText = 'SPINNING...';

            const spins = 5 + Math.random() * 3;
            const randDegree = Math.random() * 360;
            currentRotation += spins * 360 + randDegree;
            
            const canvas = document.getElementById('wheel');
            canvas.style.transition = 'transform 4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            canvas.style.transform = `rotate(${currentRotation}deg)`;

            setTimeout(() => {
                const normalized = currentRotation % 360;
                const segment = Math.floor((360 - normalized) / 60);
                const prizeIndex = Math.floor(segment / 1) % prizes.length;
                const prize = prizes[prizeIndex];

                if (prize.points > 0) {
                    points += prize.points;
                    updatePoints();
                    document.getElementById('result').innerHTML = `üéâ Won <span style="color: gold; font-size: 32px;">${prize.points}</span> Points!`;
                    showConfetti();
                } else {
                    document.getElementById('result').innerText = 'üòÖ Better luck next time!';
                }
                
                spinBtn.disabled = false;
                spinBtn.innerText = 'SPIN AGAIN!';
            }, 4200);
        }

        function showConfetti() {
            for (let i = 0; i < 60; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.background = `hsl(${Math.random()*60 + 20}, 100%, 60%)`;
                conf.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(conf);
                setTimeout(() => conf.remove(), 3000);
            }
        }

        // Leaderboard (Local Demo)
        function showLeaderboard() {
            document.getElementById('leaderboard-modal').style.display = 'flex';
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = `
                <li class="rank-1"><span>#1 GoldPlayer</span><span>1,250,000</span></li>
                <li class="rank-2"><span>#2 SilverStar</span><span>987,654</span></li>
                <li class="rank-3"><span>#3 BronzeKing</span><span>765,432</span></li>
                <li><span>#4 ${Telegram?.WebApp?.initDataUnsafe?.user?.first_name || 'You'}</span><span>${points.toLocaleString()}</span></li>
                <li><span>#5 Player5</span><span>543,210</span></li>
            `;
        }

        function closeLeaderboard() {
            document.getElementById('leaderboard-modal').style.display = 'none';
        }

        // Initialize
        updatePoints();
        document.getElementById('sound-toggle').innerText = soundEnabled ? 'üîä Sound ON' : 'üîá Sound OFF';
        drawWheel();
    </script>
</body>
</html>
